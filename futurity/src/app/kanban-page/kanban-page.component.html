<div class="position-absolute h-100 w-100 container-absolute">
  <div cdkDropList cdkDropListGroup cdkDropListOrientation="horizontal"
       [cdkDropListData]="columns" (cdkDropListDropped)="dropColumn($event)"
       class="container-fluid d-flex align-items-start body-padding"
       [cdkDropListAutoScrollStep]="10" cdkScrollable #container dragScroll [drag-scroll-disable]="['column']">
    <div class="spinner-border mx-auto" role="status" *ngIf="!columnsAreLoaded"></div>
    <div class="column text-center p-3" *ngFor="let column of columns; let i = index" cdkDrag cdkScrollable
         [contextMenu]="basicMenu" [contextMenuSubject]="column"
    >
      <h4 class="mt-2 mb-2 text-nowrap overflow-hidden text-truncate cursor-pointer"
          (click)="startChangeColumnName(i)" *ngIf="changingColumnIndex !== i"
          [ngClass]="{'px-3': column.name.length > COLUMN_NAME_LENHGT}"
          [ngbTooltip]="column.name.length > COLUMN_NAME_LENHGT ? column.name : null">
        {{column.name}}
      </h4>
      <input type="text" class="mt-2 mb-2 box-input" [value]="column.name" *ngIf="changingColumnIndex === i"
             (blur)="changeColumnName($event, i)"
             (keyup.enter)="changeColumnName($event, i)"
             (keyup.escape)="abortColumnChanging()"
             #input_column_change>
      <div class="list" cdkDropList [cdkDropListData]="column.tasks" (cdkDropListDropped)="dropTask($event, i)"
           cdkScrollable [cdkDropListAutoScrollStep]="10"
           [ngStyle]="{'max-height': (container.offsetHeight - 150) + 'px'}">
        <div class="box" *ngFor="let task of column.tasks; let ti = index;" cdkDrag [contextMenu]="basicMenu"
             [contextMenuSubject]="task">
          <div class="text-nowrap overflow-hidden text-truncate cursor-pointer"
               *ngIf="i !== changingTaskIndex.columnIndex || ti !== changingTaskIndex.taskIndex"
               (click)="startChangeTaskName({columnIndex: i, taskIndex: ti})"
               [ngClass]="{'px-3': task.name.length > TASK_NAME_LENHGT}"
               [ngbTooltip]="task.name.length > TASK_NAME_LENHGT ? task.name : null"
          >
            {{task.name}}
          </div>
          <input type="text" class="box-input p-0" [value]="task.name" *ngIf="i === changingTaskIndex.columnIndex
           && ti === changingTaskIndex.taskIndex"
                 (blur)="changeTaskName($event, i, ti)"
                 (keyup.enter)="changeTaskName($event, i, ti)"
                 (keyup.escape)="abortTaskChanging()"
                 #input_task_change>
        </div>
      </div>
      <div class="box" *ngIf="creationNewTask && i === creationColumnIndex">
        <input class="box-input" type="text"
               (blur)="creationTaskUnFocus($event)"
               (keyup.enter)="creationTaskUnFocus($event)"
               (keyup.escape)="abortTaskCreation()" #input_box>
      </div>
      <div class="box add" (click)="startCreateTask(i)"
           *ngIf="!creationNewTask || i !== creationColumnIndex"
      >+
      </div>
    </div>
    <div class="column text-center p-3" *ngIf="creationNewColumn">
      <input type="text" class="mt-2 mb-2 box-input"
             (blur)="creationColumnUnFocus($event)"
             (keyup.enter)="creationColumnUnFocus($event)"
             (keyup.escape)="abortColumnCreation()"
             #input_column>
    </div>
    <div class="column text-center p-3 column-add" (click)="startCreateColumn()"
         *ngIf="!creationNewColumn && columnsAreLoaded">
      <h2 class="mt-1 mb-1">+</h2>
    </div>
  </div>
</div>
<context-menu>
  <ng-template contextMenuItem let-item (execute)="delete($event.item)">Delete {{item.name}}</ng-template>
</context-menu>
